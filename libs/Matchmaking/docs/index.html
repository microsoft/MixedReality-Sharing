<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>MixedReality-Sharing Matchmaking 0.0.1 | MixedReality-Sharing Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="MixedReality-Sharing Matchmaking 0.0.1 | MixedReality-Sharing Documentation ">
    <meta name="generator" content="docfx 1.0.0.0">
    
    <link rel="shortcut icon" href="../../../mr-sharing_icon.png">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../../../toc.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../mr-sharing_icon.png" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list"></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="matchmaking">


<p>The Matchmaking library automates the process of discovering and joining MR experiences over the network.</p>
<p>Matchmaking is a C# .NET Standard 2.0 library. It is available as a <a href="insert_link">NuGet package</a>. Alternatively, the Microsoft.MixedReality.Sharing.Matchmaking project can be added to a Visual Studio solution and built from source.</p>
<p>Currently the library contains a simple system to publish and discover arbitrary resources (application users, shared experiences, or others) on a local network using UDP. Check the <a href="../../../docs/manual/roadmap.md">project roadmap</a> for planned features.</p>
<h2 id="resource-discovery">Resource discovery</h2>
<p>Matchmaking defines a <strong>resource</strong> as an application-specific entity available on the network. Application clients looking for shared experiences can be resources, as well as hosting servers or individual sessions of a shared experience.</p>
<p>A resource has:</p>
<ul>
<li>a <em>connection string</em>: an application-defined string that indicates how to connect to the resource. This can be an URL, an IP address-port pair, or any string that can be interpreted by the network transport used by the application to start a communication with the resource.</li>
<li>a <em>category string</em>: an application-defined string that indicates the type of the resource. This can be used to distinguish between resources published by different applications or between different types of resources within the same application (e.g. users vs shared sessions).</li>
<li>a set of optional <em>attributes</em>, application-defined key-value pairs. These can be used to expose room properties or capabilities to the discovery system.</li>
</ul>
<p><a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.IDiscoveryAgent.html">IDiscoveryAgent</a> is the main entry point of the discovery system. Through an agent you can:</p>
<ol>
<li><p><strong>publish</strong> resources on the network for other application processes to discover:</p>
<pre><code class="lang-csharp">IDiscoveryAgent agent = InitDiscoveryAgent();
var cts = new CancellationTokenSource();
string category = &quot;myapp/session&quot;;
string connection = &quot;http://myappserver.org/session42&quot;;
var attributes = new Dictionary&lt;string, string&gt;{ [&quot;environment&quot;] = &quot;house&quot; };
IDiscoveryResource newSession = await agent.PublishAsync(category, connection, attributes, cts.Token);
</code></pre>
</li>
<li><p><strong>subscribe</strong> to resources published by other application processes:</p>
<pre><code class="lang-csharp">string category = &quot;myapp/session&quot;;
IDiscoverySubscription sessionSubscription = agent.Subscribe(category);
IDiscoveryResource foundSession = null;
sessionSubscription.Updated +=
    subscription =&gt;
    {
        foreach (IDiscoveryResource res in sessionSubscription.Resources)
        {
            if (res.Attributes[&quot;environment&quot;] == &quot;house&quot;)
            {
                Console.WriteLine(&quot;Discovered session at &quot; + res.Connection);
                foundSession = res;

                // Unsubscribe from further updates.
                sessionSubscription.Dispose();
            }
        }
    };
</code></pre>
</li>
</ol>
<p>The <a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.IDiscoveryResource.html">IDiscoveryResource</a> interface gives read access to resources published and discovered. In general, the publisher of a resource can edit its attribute after publishing by calling <a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.IDiscoveryResource.html#Microsoft_MixedReality_Sharing_Matchmaking_IDiscoveryResource_RequestEdit">IDiscoveryResource.RequestEdit</a> and using the obtained <a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.IDiscoveryResourceEditor.html">IDiscoveryResourceEditor</a>.</p>
<p><code>IDiscoveryAgent.Dispose()</code> stops advertising resources and terminates any active subscriptions.</p>
<p>See the <a href="../examples/P2PChat/P2PChat.cs">P2PChat demo</a> for a usage example.</p>
<h2 id="peer-to-peer-discovery-agent">Peer-to-peer discovery agent</h2>
<p>The discovery API is generic and can be implemented on top of a variety of protocols/network transports. The Matchmaking library contains a simple implementation, useful for prototypes/demos where all the participant devices are joined to the same local network or multicast group.</p>
<p><a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.PeerDiscoveryAgent.html">PeerDiscoveryAgent</a> implements IDiscoveryAgent using a simple peer-to-peer protocol loosely based on <a href="https://tools.ietf.org/html/draft-cai-ssdp-v1-03">SSDP</a>. When an agent publishes a resource, it starts periodically broadcasting announcement messages announcing its availability and attributes. When an agent subscribes to a category, it broadcasts a query message to which publishers reply with the current active resources, and starts listening for periodic announcements. Every announcement contains the resource lifetime in seconds - agents will consider a resource expired after an interval equal to its lifetime has passed from the last announcement about the resource.</p>
<p>Messages are exchanged between agents using a <a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.IPeerDiscoveryTransport.html">IPeerDiscoveryTransport</a> specified on agent creation:</p>
<pre><code class="lang-csharp">var transport = new UdpPeerDiscoveryTransport(IPAddress.Broadcast, 45278);
var agent = new PeerDiscoveryAgent(transport);
</code></pre>
<p>IPeerDiscoveryTransport is a simple convenience interface to send and receive broadcast messages among peers. The library contains an implementation that exchanges messages through UDP broadcast/multicast (<a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.IPeerDiscoveryTransport.html">UdpPeerDiscoveryTransport</a>) plus a memory-based, in-process one for testing (<a class="xref" href="../../../api/Microsoft.MixedReality.Sharing.Matchmaking.MemoryPeerDiscoveryTransport.html">MemoryPeerDiscoveryTransport</a>).</p>
<h3 id="limitations">Limitations</h3>
<p>PeerDiscoveryAgent is meant to be used in small-size prototypes and is not recommended in production application that expect to handle many concurrent agents/resources. Importantly, the implementation assumes a trusted network and it is not suitable to applications that might deal with malicious network traffic.</p>
<p>UdpPeerDiscoveryTransport sends one UDP packet per resource announcement, including all the resource data - category, connection, attributes. Depending on the network configuration, UDP packets bigger than a certain size might be fragmented - increasing packet loss and decreasing performance - or dropped by the network stack. The implementation will therefore work reliably only if the total data for each resource is low - generally under 1KB.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/microsoft/MixedReality-Sharing/blob/4982db35cdb6e73709fa2cb5251c16d4cb5b64c5/libs/Matchmaking/docs/index.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
